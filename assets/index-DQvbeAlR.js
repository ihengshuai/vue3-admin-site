var oe=Object.defineProperty;var G=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var $=(r,n,e)=>n in r?oe(r,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[n]=e,J=(r,n)=>{for(var e in n||(n={}))te.call(n,e)&&$(r,e,n[e]);if(G)for(var e of G(n))se.call(n,e)&&$(r,e,n[e]);return r};var w=(r,n,e)=>new Promise((P,E)=>{var h=c=>{try{m(e.next(c))}catch(d){E(d)}},b=c=>{try{m(e.throw(c))}catch(d){E(d)}},m=c=>c.done?P(c.value):Promise.resolve(c.value).then(h,b);m((e=e.apply(r,n)).next())});import{i as K,e as Q}from"./index.CCNGGU.js";import{a4 as ie,f as D,c as re,h as H,I as q,d as ce,r as fe,k as a,E as M,S as de}from"./vue-C05a2vRq.js";import{f as ve,a as me}from"./index-Cwyg722P.js";import{I as pe}from"./index-Ciw2v_La.js";import{I as R,S as be,J as he,R as W,K as C,N as A,O as ge,P as ye,h as Fe,z as X,Q as Ee}from"./antd-B5dqVz-4.js";import"./index-CKfTYYqA.js";import"./dom-B5d93tGn.js";function we(r){const{formModel:n,baseProps:e,formRules:P={},initFormData:E,onSubmit:h,onDataChange:b}=r;if(!ie(n))throw new Error("model must be reactive");const m=D([]),c=D(),d=D(!1),g=D(),U={span:4},V={span:20},t=re(()=>J({model:n,rules:P,labelCol:U,wrapperCol:V,colon:!1},K(e)?e():e));y();function y(){H(()=>{c.value&&(K(b)?(z(),b==null||b(c.value)):_(c.value))}),H(()=>{m.value.length?d.value=!0:d.value=!1}),i()}function i(){return w(this,null,function*(){try{T();const l=yield E(L());l&&(c.value=l)}finally{k()}})}function _(l,u={}){if(!n)return null;const o=n;return Object.keys(o).forEach(s=>{var B,N;const{field:p,isShow:F}=o[s];if(F===void 0||F!=null&&F())if(typeof(u==null?void 0:u[s])=="function"){if(p!==void 0){const v=p.split(".");let f=l;v.forEach(S=>{f&&(f=f[S])}),o[s].value=(B=u==null?void 0:u[s])==null?void 0:B.call(u,f,l)}else o[s].value=(N=u==null?void 0:u[s])==null?void 0:N.call(u,l[s],l);return}else if(p!==void 0){const v=p.split(".");let f=l;v.forEach(S=>{f&&(f=f[S])}),f&&(o[s].value=f)}else o[s].value=l[s]}),o}function Z(l){const u=q(n),{value:o,transform:s,type:p}=u[l]||{};return s?s==null?void 0:s(o,u):O(o,p)}function L(){const l={},u=q(n);return Object.keys(u).forEach(o=>{const{value:s,type:p,field:F,isForm:B,isShow:N,transform:v}=u[o];if((N===void 0||N())&&B!==!1)if(F!==void 0){const f=F.split("."),S=f.length;let x=l;f.forEach((j,ne)=>{ne<S-1?(x[j]||(x[j]={}),x=x[j]):x[j]=v!==void 0?v==null?void 0:v(s,u):O(s,p)})}else l[o]=v!==void 0?v==null?void 0:v(s,u):O(s,p)}),l}function I(){return w(this,null,function*(){if(yield le())try{T();const u=L(),o=yield ee(u);o&&(c.value=o)}finally{k()}})}function ee(l){return w(this,null,function*(){return(yield h==null?void 0:h(l))||null})}function le(){return w(this,null,function*(){if(g!=null&&g.value)try{return yield g.value.validate(),!0}catch(l){return!1}return!0})}function z(){const l=q(n);Object.keys(l).forEach(u=>{const{type:o,value:s}=l[u];n[u].value=o===Array||Q(s)?[]:null})}function ue(){const l=q(n);Object.keys(l).forEach(u=>{const o=l[u];o.isShow!==void 0&&!o.isShow()&&(n[u].value=null)})}function O(l,u){if(l)if(u===Number){const o=Number(l);return isNaN(o)?null:o}else return u===Boolean?l==="true":u===Array?Q(l)?l:[l]:l}function T(){m.value.push("")}function k(){m.value.pop()}function ae(){m.value=[],d.value=!d.value}return{formRef:g,formData:c,formLoading:d,labelCol:U,wrapperCol:V,formProps:t,initFormModel:_,loadFormData:i,getFormValues:L,getFormValueByField:Z,clearModel:z,clearUnnecessaryModel:ue,handleSubmitForm:I,toggleLoading:ae}}const Y=[{label:"老板",value:"boss"},{label:"员工",value:"worker"}],Ce=["篮球🏀","乒乓球🏓","羽毛球🏸"],De=[{label:"男性",value:"male"},{label:"女性",value:"female"}],Pe=[{label:"北京",value:"beijing"},{label:"上海",value:"shanghai"},{label:"广州",value:"guangzhou"},{label:"深圳",value:"shenzhen"},{label:"杭州",value:"hangzhou"},{label:"成都",value:"chengdu"},{label:"重庆",value:"chongqing"}],qe=ce({name:"FormPage",setup(){const r=D(),n=D(Y[0].value),e=fe({name:{value:"test",transform:t=>t==null?void 0:t.toUpperCase()},age:{value:null,type:Number,transform:t=>Number(t)},sex:{value:null},city:{value:[],field:"address.city"},hobbies:{value:null},income:{value:null,type:Number,isShow:()=>n.value!=="boss"}}),P={age:{validator(t,y){return w(this,null,function*(){return!y||isNaN(parseInt(y.value))?Promise.reject("年龄不能为空"):Promise.resolve()})},trigger:"blur"}},{formRef:E,formProps:h,formLoading:b,loadFormData:m,initFormModel:c,handleSubmitForm:d,getFormValueByField:g,clearModel:U}=we({formModel:e,formRules:P,baseProps:{scrollToFirstError:!0,colon:!0},initFormData(t){return ve((t==null?void 0:t.name)||"test")},onSubmit:t=>me(t.name,t),onDataChange(t){c(t)}});return()=>a(pe,{withCard:!0},{default:()=>[a(R,{type:"primary",danger:!0,onClick:d,style:"margin-bottom:24px"},{default:()=>[M("测试重复提交")]}),a(be,{spinning:b.value},{default:()=>[a(he,de({ref:E},h.value),{default:()=>{var t,y;return[a(W,{value:n.value,"onUpdate:value":i=>n.value=i,options:Y,optionType:"button",buttonStyle:"solid",onChange:U},null),a("br",null,null),a("br",null,null),a(C,{label:"姓名",name:"name",required:!0},{default:()=>[a(A,{value:e.name.value,"onUpdate:value":i=>e.name.value=i},null)]}),a(C,{label:"年龄",name:"age",required:!0},{default:()=>[a(A,{value:e.age.value,"onUpdate:value":i=>e.age.value=i},null)]}),a(C,{label:"性别",name:"sex",required:!0},{default:()=>[a(W,{value:e.sex.value,"onUpdate:value":i=>e.sex.value=i,options:De},null)]}),a(C,{label:"城市",name:"city"},{default:()=>[a(ge,{value:e.city.value,"onUpdate:value":i=>e.city.value=i,options:Pe,mode:"multiple",placeholder:"请选择城市"},null)]}),a(C,{label:"爱好",name:"hobbies"},{default:()=>[a(ye,{value:e.hobbies.value,"onUpdate:value":i=>e.hobbies.value=i,options:Ce},null)]}),(y=(t=e.income)==null?void 0:t.isShow)!=null&&y.call(t)?a(C,{label:"收入",name:"income"},{default:()=>[a(A,{value:e.income.value,"onUpdate:value":i=>e.income.value=i},null)]}):null,a(Fe,{justify:"end"},{default:()=>[a(X,{align:"end"},{default:()=>[a(R,{type:"primary",onClick:d},{default:()=>[M("提交")]}),a(R,{onClick:m},{default:()=>[M("初始化")]}),a(R,{onClick:U},{default:()=>[M("清空")]})]})]}),a("hr",null,null),a(X.Compact,null,{default:()=>[a(A,{value:r.value,"onUpdate:value":i=>r.value=i,placeholder:"输入表单key打印其值"},null),a(R,{onClick:()=>Ee.info(`key：${r.value}，value：${g(r.value)}`)},{default:()=>[M("打印")]})]})]}})]})]})}});export{qe as default};
